var chatApp = angular.module('chatApp', []);

chatApp.controller('LoginController', function($scope){
	$scope.userID = '';

	$scope.firstName = '';
	$scope.lastName = '';
	$scope.initials = '';
	$scope.bgcolor='#F44336';
	$scope.boxColor='';
	$scope.colors = ['F44336','E91E63','9C27B0','673AB7','3F51B5','2196F3','03A9F4','00BCD4','009688','4CAF50','8BC34A','FF5722','795548','607D8B','333333'];
	$scope.showModal = true;
	$scope.false = false;
	$scope.showNotificationModal = false;
	$scope.styleButtonActive ='';
	$scope.notificationCounter = '';

	$scope.usersList = [];
	$scope.notificationList = [];
	$scope.socket = io();




	$scope.isRegisteredAlready = function(){
		
		var fName= localStorage.getItem('firstName');
		var lName = localStorage.getItem('lastName');
		var dpColor = localStorage.getItem('dpColor');
		var initials = localStorage.getItem('initials');
		var returnValue = false;

		if(fName && lName && dpColor && initials){
			$scope.firstName = fName;
			$scope.lastName = lName;
			$scope.initials = initials;
			$scope.boxColor = {'background-color':dpColor};
			returnValue = true;	
		}

		return returnValue;
	}

	$scope.change = function(){
		$scope.initials = angular.uppercase($scope.firstName.substring(0,1) + $scope.lastName.substring(0,1));
	}

	$scope.setColor = function(color){
		$scope.bgcolor  = '#'+ color;
		$scope.boxColor = {'background-color':$scope.bgcolor};
	}

	$scope.toggleNotification = function(){
		$scope.showNotificationModal = !$scope.showNotificationModal;
		$scope.notificationCounter = '';
	}

	$scope.saveDataToLocalStorage = function(){
		localStorage.setItem('firstName',$scope.firstName);
		localStorage.setItem('lastName', $scope.lastName);
		localStorage.setItem('initials', $scope.initials);
		localStorage.setItem('dpColor', $scope.bgcolor);
	}

	$scope.register = function(){
		if($scope.firstName.trim()=='' || $scope.lastName.trim()==''){
			alert('All fields are required!');
		}else{
			$scope.saveDataToLocalStorage();
			alert('Registered Successfuly!');
		}
	}

	$scope.login = function(){
		//setUsername($scope.);
		$scope.socket.emit('login',{'firstName':$scope.firstName, 'lastName':$scope.lastName, 'initials':$scope.initials, 'dpColor':$scope.dpColor});

	}

	$scope.addNotification = function(){
		$scope.notificationList.push('');
	}

	$scope.socket.on('callBackLogin', function(data){
		if(data.UserID!=null){
			$scope.UserID = data.UserID;
			$scope.usersList = data.UserLists;
			$scope.showModal = false;
			$scope.notificationCounter++;
			$scope.$apply();
			alert('Login successfully!');
			
		}else{
			alert('Failed to login. Please try again.');
		}
	});

});